--- !ruby/object:Provider::Ansible::Example
task: !ruby/object:Provider::Ansible::Task
  name: azure_rm_frontdoor
  description: Create or update specific Front Door
  code:
    resource_group: myResourceGroup
    name: myFrontDoor
    front_door_parameters:
      location: westus
      tags:
        tag1: value1
        tag2: value2
      properties:
        routingRules:
          - name: routingRule1
            properties:
              frontend_endpoints:
                - id: >-
                    /subscriptions/{{ subscription_id }}/resourceGroups/{{
                    resource_group }}/providers/Microsoft.Network/frontDoors/{{
                    front_door_name }}/frontendEndpoints/{{ frontend_endpoint_name
                    }}
                - id: >-
                    /subscriptions/{{ subscription_id }}/resourceGroups/{{
                    resource_group }}/providers/Microsoft.Network/frontDoors/{{
                    front_door_name }}/frontendEndpoints/{{ frontend_endpoint_name
                    }}
              accepted_protocols:
                - Http
              patterns_to_match:
                - /*
              route_configuration:
                '@odata.type': >-
                  #Microsoft.Azure.FrontDoor.Models.FrontdoorForwardingConfiguration
                backend_pool:
                  id: >-
                    /subscriptions/{{ subscription_id }}/resourceGroups/{{
                    resource_group }}/providers/Microsoft.Network/frontDoors/{{
                    front_door_name }}/backendPools/{{ backend_pool_name }}
              enabled_state: Enabled
        healthProbeSettings:
          - name: healthProbeSettings1
            properties:
              path: /
              protocol: Http
              interval_in_seconds: '120'
        loadBalancingSettings:
          - name: loadBalancingSettings1
            properties:
              sample_size: '4'
              successful_samples_required: '2'
        backendPools:
          - name: backendPool1
            properties:
              backends:
                - address: w3.contoso.com
                  http_port: '80'
                  https_port: '443'
                  weight: '1'
                  priority: '2'
                - address: contoso.com.website-us-west-2.othercloud.net
                  http_port: '80'
                  https_port: '443'
                  weight: '2'
                  priority: '1'
                - address: contoso1.azurewebsites.net
                  http_port: '80'
                  https_port: '443'
                  weight: '1'
                  priority: '1'
              load_balancing_settings:
                id: >-
                  /subscriptions/{{ subscription_id }}/resourceGroups/{{
                  resource_group }}/providers/Microsoft.Network/frontDoors/{{
                  front_door_name }}/loadBalancingSettings/{{
                  load_balancing_setting_name }}
              health_probe_settings:
                id: >-
                  /subscriptions/{{ subscription_id }}/resourceGroups/{{
                  resource_group }}/providers/Microsoft.Network/frontDoors/{{
                  front_door_name }}/healthProbeSettings/{{
                  health_probe_setting_name }}
        frontendEndpoints:
          - name: frontendEndpoint1
            properties:
              host_name: www.contoso.com
              session_affinity_enabled_state: Enabled
              session_affinity_ttl_seconds: '60'
              web_application_firewall_policy_link:
                id: >-
                  /subscriptions/{{ subscription_id }}/resourceGroups/{{
                  resource_group
                  }}/providers/Microsoft.Network/frontDoorWebApplicationFirewallPolicies/{{
                  front_door_web_application_firewall_policy_name }}
          - name: default
            properties:
              host_name: frontDoor1.azurefd.net
        backendPoolsSettings:
          enforceCertificateNameCheck: Enabled
        enabledState: Enabled
  
# Ruby
# Package your Ruby project.
# Add steps that install rails, analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/ruby

trigger:
- master

pool:
  vmImage: 'ubuntu-latest'

steps:
- task: UseRubyVersion@0
  inputs:
    versionSpec: '>= 2.5'

- script: git submodule update --init
  displayName: 'Initialize submodules'

- script: |
    cd ./tools/magic-modules
    gem install bundler
    bundle install --retry=3 --jobs=4
  displayName: 'bundle install'

- script: |
    git config --global user.email "audevbot@microsoft.com"
    git config --global user.name "audevbot"
    git config --global credential.helper store
    echo "https://audevbot:$(GH_TOKEN)@github.com" > ~/.git-credentials
  displayName: 'git config'

- script: |
  displayName: 'code generation'